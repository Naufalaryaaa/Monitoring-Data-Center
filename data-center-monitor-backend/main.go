package main

import (
	"log"
	"net/http"

	"github.com/gin-contrib/cors"
	"github.com/gin-gonic/gin"
)

type Data struct {
	Date   string `json:"date"`
	Growth int    `json:"growth"`
}

func getDatabaseGrowth(c *gin.Context) {
	startDate := c.DefaultQuery("start", "2025-01-01") // Default start date
	endDate := c.DefaultQuery("end", "2025-02-28")     // Default end date

	// Dummy data for illustration
	data := []Data{
		{"2025-01-01", 120},
		{"2025-01-02", 130},
		{"2025-01-03", 160},
		{"2025-01-04", 170},
		{"2025-01-05", 180},
		{"2025-01-06", 150},
		{"2025-01-07", 160},
		{"2025-01-08", 170},
		{"2025-01-09", 150},
		{"2025-01-10", 160},
		{"2025-01-11", 155},
		{"2025-01-12", 170},
		{"2025-01-13", 160},
		{"2025-01-14", 170},
		{"2025-01-15", 180},
		{"2025-01-16", 150},
		{"2025-01-17", 160},
		{"2025-01-18", 170},
		{"2025-01-19", 150},
		{"2025-01-20", 160},
		{"2025-01-21", 135},
		{"2025-01-22", 130},
		{"2025-01-23", 160},
		{"2025-01-24", 170},
		{"2025-01-25", 200},
		{"2025-01-26", 190},
		{"2025-01-27", 160},
		{"2025-01-28", 170},
		{"2025-01-29", 180},
		{"2025-01-30", 190},
		{"2025-01-31", 160},
		{"2025-02-01", 120},
		{"2025-02-02", 130},
		{"2025-02-03", 160},
		{"2025-02-04", 170},
		{"2025-02-05", 180},
		{"2025-02-06", 150},
		{"2025-02-07", 160},
		{"2025-02-08", 170},
		{"2025-02-09", 150},
		{"2025-02-10", 160},
		{"2025-02-11", 155},
		{"2025-02-12", 170},
		{"2025-02-13", 160},
		{"2025-02-14", 170},
		{"2025-02-15", 180},
		{"2025-02-16", 150},
		{"2025-02-17", 160},
		{"2025-02-18", 170},
		{"2025-02-19", 150},
		{"2025-02-20", 160},
		{"2025-02-21", 135},
		{"2025-02-22", 130},
		{"2025-02-23", 160},
		{"2025-02-24", 170},
		{"2025-02-25", 200},
		{"2025-02-26", 200},
		{"2025-02-27", 160},
		{"2025-02-28", 170},
		{"2025-03-01", 120},
		{"2025-03-02", 130},
		{"2025-03-03", 160},
		{"2025-03-04", 170},
		{"2025-03-05", 180},
		{"2025-03-06", 150},
		{"2025-03-07", 160},
		{"2025-03-08", 170},
		{"2025-03-09", 150},
		{"2025-03-10", 160},
		{"2025-03-11", 155},
		{"2025-03-12", 170},
		{"2025-03-13", 160},
		{"2025-03-14", 170},
		{"2025-03-15", 180},
		{"2025-03-16", 150},
		{"2025-03-17", 160},
		{"2025-03-18", 170},
		{"2025-03-19", 150},
		{"2025-03-20", 160},
		{"2025-03-21", 135},
		{"2025-03-22", 130},
		{"2025-03-23", 160},
		{"2025-03-24", 170},
		{"2025-03-25", 200},
		{"2025-03-26", 190},
		{"2025-03-27", 160},
		{"2025-03-28", 170},
		{"2025-03-29", 180},
		{"2025-03-30", 190},
		{"2025-03-31", 160},
		{"2025-04-01", 120},
		{"2025-04-02", 130},
		{"2025-04-03", 160},
		{"2025-04-04", 170},
		{"2025-04-05", 180},
		{"2025-04-06", 150},
		{"2025-04-07", 160},
		{"2025-04-08", 170},
		{"2025-04-09", 150},
		{"2025-04-10", 160},
		{"2025-04-11", 155},
		{"2025-04-12", 170},
		{"2025-04-13", 160},
		{"2025-04-14", 170},
		{"2025-04-15", 180},
		{"2025-04-16", 150},
		{"2025-04-17", 160},
		{"2025-04-18", 170},
		{"2025-04-19", 150},
		{"2025-04-20", 160},
		{"2025-04-21", 135},
		{"2025-04-22", 130},
		{"2025-04-23", 160},
		{"2025-04-24", 170},
		{"2025-04-25", 200},
		{"2025-04-26", 190},
		{"2025-04-27", 160},
		{"2025-04-28", 170},
		{"2025-04-29", 180},
		{"2025-04-30", 190},
	}

	// Filter data based on the requested date range (this is just for illustration)
	filteredData := []Data{}
	for _, entry := range data {
		if entry.Date >= startDate && entry.Date <= endDate {
			filteredData = append(filteredData, entry)
		}
	}

	c.JSON(http.StatusOK, filteredData)
}

func main() {
	r := gin.Default()

	// Enable CORS
	r.Use(cors.Default()) // This will allow all origins by default

	// Route to fetch database growth data
	r.GET("/api/database-growth", getDatabaseGrowth)

	// Start server
	if err := r.Run(":8080"); err != nil {
		log.Fatal("Server failed to start: ", err)
	}
}
